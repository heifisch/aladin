<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE script:module PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "module.dtd">
<script:module xmlns:script="http://openoffice.org/2000/script" script:name="Export" script:language="StarBasic">&apos; Erstellt von Heiko Fischer
&apos; heiko.fischer@aladin-gmbh.de  -  www.aladin-gmbh.de
&apos; Veröffentlicht unter GPL

REM  *****  BASIC  *****
Option Explicit

Dim oDialogExport AS Object,oDialogExportModel AS Object

Sub DialogExportSchreibSchutz()
	Dim oOptionDatum AS Object,oOptionLokation AS Object,oOptionZusammenfassung AS Object
	Dim oCheckBoxDatum AS Object,oCheckBoxLokation AS Object

	oOptionZusammenfassung = oDialogExportModel.getByName(&quot;OptionZusammenfassung&quot;)
	oOptionDatum = oDialogExportModel.getByName(&quot;OptionDatum&quot;)
	oOptionLokation = oDialogExportModel.getByName(&quot;OptionLokation&quot;)
	oCheckBoxDatum = oDialogExportModel.getByName(&quot;CheckBoxDatum&quot;)
	oCheckBoxLokation = oDialogExportModel.getByName(&quot;CheckBoxLokation&quot;)

	if oOptionZusammenfassung.State=1 then
		oCheckBoxDatum.Enabled=0
		oCheckBoxLokation.Enabled=0
		oCheckBoxDatum.State=0
		oCheckBoxLokation.State=0
	elseif oOptionDatum.State=1 then
		oCheckBoxDatum.Enabled=0
		oCheckBoxDatum.State=0
		oCheckBoxLokation.Enabled=1
	elseif oOptionLokation.State=1 then
		oCheckBoxDatum.Enabled=1
		oCheckBoxLokation.Enabled=0
		oCheckBoxLokation.State=0
	End if
End Sub

Sub Document_exportieren()
	Dim vStatus AS Variant
	Dim iGesperrt AS integer
	Dim iCount AS Integer,iCountFormulare AS Integer,iCountDatensaetze AS Integer
	Dim oRecord1 AS Object,oRecord2 AS Object,oRecord3 AS Object
	Dim sSQL1 AS String,sSQL4 AS String,sSQL5 AS String,sSQL6 AS String,sSQL8 AS String,sSQL9 AS String
	Dim sSQL2 AS String,sSQL2_Columns AS String,sSQL2_Count AS String
	Dim sSQL3 AS String,sSQL3_Columns AS String,sSQL3_Count AS String
	Dim sSQL7 AS String,sSQL7_Columns AS String,sSQL7_Count AS String
	Dim oOptionAngebote1 AS Object,oOptionAuftrag1 AS Object,oOptionLieferscheine1 AS Object
	Dim oOptionAufmasze1 AS Object,oOptionRechnungen1 AS Object,oOptionGutschriften1 AS Object
	Dim oOptionAngebote2 AS Object
	Dim oOptionAuftrag2 AS Object,oOptionLieferscheine2 AS Object,oOptionAufmasze2 AS Object
	Dim oOptionRechnungen2 AS Object,oOptionGutschriften2 AS Object
	Dim oOptionDatum AS Object,oOptionLokation AS Object,oOptionZusammenfassung AS Object
	Dim oCheckBoxDatum AS Object,oCheckBoxLokation AS Object
	Dim oRecordGesperrt AS Object,oRecordGliederung1 AS Object,oRecordGliederung2 AS Object,oRecordLeistungen AS Object
	Dim sDocumentID_export AS String,iSchreibschutz_export AS Integer
	Dim iDocTypID_export AS Integer
	Dim sBemerkung AS String,sMenge AS String,sZwischensumme AS String
	Dim sLV_Pos AS String,sLeistungsID AS String,sLeistungsbezeichnung AS String,sEinkaufspreis AS String
	Dim sMaterialaufschlagsatz AS String,sBauzeit AS String,sMinutenverrechnungssatz AS String
	Dim sBestellnummer AS String,sLeistungsbeschreibung AS String
	Dim iCountGliederung1 AS Integer,iAnzahlGliederung1 AS Integer
	Dim iCountGliederung2 AS Integer,iAnzahlGliederung2 AS Integer
	Dim iCountLeistungen AS Integer,iAnzahlLeistungen AS Integer
	Dim iMaxPos_export AS Integer,iPosGliederung1 AS Integer,iPosGliederung2 AS Integer
	Dim sGliederung1 AS String,sGliederungsText1 AS String,sTextVorLokation AS String
	Dim sGliederung2 AS String,sGliederungsText2 AS String
	
	if lProjektID=0 then
		MsgBox(&quot;Bitte wählen Sie erst ein Projekt aus!&quot;,16,sTitle_lokal)
		Exit Sub
	End if
	
	GlobalScope.BasicLibraries.LoadLibrary(&quot;ALADIN&quot;)
	DialogLibraries.LoadLibrary( &quot;Standard&quot; )
	sGliederung1=&quot;&quot;
	sGliederung2=&quot;&quot;
	sZwischensumme=&quot;&quot;
	oDialogExport = CreateUnoDialog( DialogLibraries.Standard.Export )
	oDialogExportModel = oDialogExport.Model
	oOptionDatum = oDialogExportModel.getByName(&quot;OptionDatum&quot;)
	oOptionLokation = oDialogExportModel.getByName(&quot;OptionLokation&quot;)
	oCheckBoxDatum = oDialogExportModel.getByName(&quot;CheckBoxDatum&quot;)
	oCheckBoxLokation = oDialogExportModel.getByName(&quot;CheckBoxLokation&quot;)
	oOptionZusammenfassung = oDialogExportModel.getByName(&quot;OptionZusammenfassung&quot;)
	oOptionAngebote1 = oDialogExportModel.getByName(&quot;OptionAngebote1&quot;)
	oOptionAuftrag1 = oDialogExportModel.getByName(&quot;OptionAuftrag1&quot;)
	oOptionLieferscheine1 = oDialogExportModel.getByName(&quot;OptionLieferscheine1&quot;)
	oOptionAufmasze1 = oDialogExportModel.getByName(&quot;OptionAufmasze1&quot;)
	oOptionRechnungen1 = oDialogExportModel.getByName(&quot;OptionRechnungen1&quot;)
	oOptionGutschriften1 = oDialogExportModel.getByName(&quot;OptionGutschriften1&quot;)
	oOptionAngebote2 = oDialogExportModel.getByName(&quot;OptionAngebote2&quot;)
	oOptionAuftrag2 = oDialogExportModel.getByName(&quot;OptionAuftrag2&quot;)
	oOptionLieferscheine2 = oDialogExportModel.getByName(&quot;OptionLieferscheine2&quot;)
	oOptionAufmasze2 = oDialogExportModel.getByName(&quot;OptionAufmasze2&quot;)
	oOptionRechnungen2 = oDialogExportModel.getByName(&quot;OptionRechnungen2&quot;)
	oOptionGutschriften2 = oDialogExportModel.getByName(&quot;OptionGutschriften2&quot;)
	
	oDialogExport.Title=sTitle_lokal &amp; &quot; - neues Dokument erstellen&quot;
	
	sSQL1=&quot;SELECT Gesperrt FROM Steuerung&quot;&amp;_
		&quot; WHERE ClientID &lt;= &quot;&amp; (iUserID_lokal*40) &amp;_
		&quot; AND ClientID &gt; &quot;&amp; (iUserID_lokal*40)-40 &amp;_
		&quot; ORDER BY ClientID ASC&quot;

	wait 1
	iCountFormulare=0
	For iCount = 1 to 12
		oRecordGesperrt=oResultGesperrt(sSQL1)
		oRecordGesperrt.absolute(iCount)
		iGesperrt=oRecordGesperrt.getInt(1)
		if iCount = 1 then 
			if iGesperrt = 1 then
				oOptionAngebote1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 2 then
			if iGesperrt = 1 then
				oOptionAngebote2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 3 then
			if iGesperrt = 1 then
				oOptionAuftrag1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 4 then
			if iGesperrt = 1 then
				oOptionAuftrag2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 5 then
			if iGesperrt = 1 then
				oOptionLieferscheine1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 6 then
			if iGesperrt = 1 then
				oOptionLieferscheine2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 7 then
			if iGesperrt = 1 then
				oOptionAufmasze1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 8 then
			if iGesperrt = 1 then
				oOptionAufmasze2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 9 then
			if iGesperrt = 1 then
				oOptionRechnungen1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 10 then
			if iGesperrt = 1 then
				oOptionRechnungen2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		elseif iCount = 11 then
			if iGesperrt = 1 then
				oOptionGutschriften1.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if	
		elseif iCount = 12 then
			if iGesperrt = 1 then
				oOptionGutschriften2.Enabled=0
			else
				iCountFormulare=iCountFormulare+1
			End if
		End if	
	Next iCount
	if iCountFormulare=0 then
		MsgBox(&quot;Bitte schließen Sie das Formular in welches Sie das Dokument exportieren wollen!&quot;,16,sTitle_lokal)
		Exit Sub
	End if

	vStatus = oDialogExport.Execute()
	if vStatus = 0 then
		exit sub
	end if
	
	SetDocUserProperty(&quot;oClientID_export&quot;, 0)
	if oOptionAngebote1.State=1 OR oOptionAngebote2.State=1 then
		iDocTypID_export=&quot;1&quot;
		if oOptionAngebote1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+1)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAngebote2_TEMP1(iUserID_lokal))
		end if
		if oOptionAngebote2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+2)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAngebote2_TEMP2(iUserID_lokal))
		end if
		if iEinstellungsID_lokal=1 _ 
			OR InStr(fsTableList,&quot;;Angebote1_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _ 
			OR InStr(fsTableList,&quot;;Angebote2_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiBemAngebote_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiSuAngebote_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
		then
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Angebote1&quot;)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Angebote2&quot;)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemAngebote&quot;)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuAngebote&quot;)
		else
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Angebote1_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Angebote2_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemAngebote_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuAngebote_&quot; &amp; iEinstellungsID_lokal)
		end if
	elseif oOptionAuftrag1.State=1 OR oOptionAuftrag2.State=1 then
		iDocTypID_export=&quot;2&quot;
		if oOptionAuftrag1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+3)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAuftragsbestaetigungen2_TEMP1(iUserID_lokal))
		end if
		if oOptionAuftrag2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+4)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAuftragsbestaetigungen2_TEMP2(iUserID_lokal))
		end if
		SetDocUserProperty(&quot;oTabelle1_export&quot;, sAuftragsbestaetigungen1)
		SetDocUserProperty(&quot;oTabelle2_export&quot;, sAuftragsbestaetigungen2)
		SetDocUserProperty(&quot;oBemerkungen_export&quot;, sZwiBemAuftragsbestaetigungen)
		SetDocUserProperty(&quot;oZwischensummen_export&quot;, sZwiSuAuftragsbestaetigungen)
	elseif oOptionLieferscheine1.State=1 OR oOptionLieferscheine2.State=1 then
		iDocTypID_export=&quot;3&quot;
		if oOptionLieferscheine1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+5)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sLieferscheine2_TEMP1(iUserID_lokal))
		end if
		if oOptionLieferscheine2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+6)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sLieferscheine2_TEMP2(iUserID_lokal))
		end if
		if iEinstellungsID_lokal=1 _ 
			OR InStr(fsTableList,&quot;;Lieferscheine1_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _ 
			OR InStr(fsTableList,&quot;;Lieferscheine2_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiBemLieferscheine_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiSuLieferscheine_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
		then
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Lieferscheine1&quot;)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Lieferscheine2&quot;)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemLieferscheine&quot;)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuLieferscheine&quot;)
		else
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Lieferscheine1_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Lieferscheine2_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemLieferscheine_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuLieferscheine_&quot; &amp; iEinstellungsID_lokal)
		end if
	elseif oOptionAufmasze1.State=1 OR oOptionAufmasze2.State=1 then
		iDocTypID_export=&quot;4&quot;
		if oOptionAufmasze1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+7)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAufmasze2_TEMP1(iUserID_lokal))
		end if
		if oOptionAufmasze2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+8)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sAufmasze2_TEMP2(iUserID_lokal))
		end if
		if iEinstellungsID_lokal=1 _ 
			OR InStr(fsTableList,&quot;;Aufmasze1_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _ 
			OR InStr(fsTableList,&quot;;Aufmasze2_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiBemAufmasze_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiSuAufmasze_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
		then
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Aufmasze1&quot;)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Aufmasze2&quot;)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemAufmasze&quot;)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuAufmasze&quot;)
		else
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Aufmasze1_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Aufmasze2_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemAufmasze_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuAufmasze_&quot; &amp; iEinstellungsID_lokal)
		end if
	elseif oOptionRechnungen1.State=1 OR oOptionRechnungen2.State=1 then
		iDocTypID_export=&quot;5&quot;
		if oOptionRechnungen1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+9)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sRechnungen2_TEMP1(iUserID_lokal))
		end if
		if oOptionRechnungen2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+10)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sRechnungen2_TEMP2(iUserID_lokal))
		end if
		if iEinstellungsID_lokal=1 _ 
			OR InStr(fsTableList,&quot;;Rechnungen1_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _ 
			OR InStr(fsTableList,&quot;;Rechnungen2_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiBemRechnungen_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiSuRechnungen_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
		then
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Rechnungen1&quot;)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Rechnungen2&quot;)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemRechnungen&quot;)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuRechnungen&quot;)
		else
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Rechnungen1_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Rechnungen2_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemRechnungen_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuRechnungen_&quot; &amp; iEinstellungsID_lokal)
		end if
	elseif oOptionGutschriften1.State=1 OR oOptionGutschriften2.State=1 then
		iDocTypID_export=&quot;6&quot;
		if oOptionGutschriften1.State=1 then 
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+11)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sGutschriften2_TEMP1(iUserID_lokal))
		end if
		if oOptionGutschriften2.State=1 then
			SetDocUserProperty(&quot;oClientID_export&quot;, iClientIDOffset(iUserID_lokal)+12)
			SetDocUserProperty(&quot;oArbeitstabelle_export&quot;, sGutschriften2_TEMP2(iUserID_lokal))
		end if
		if iEinstellungsID_lokal=1 _ 
			OR InStr(fsTableList,&quot;;Gutschriften1_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _ 
			OR InStr(fsTableList,&quot;;Gutschriften2_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiBemGutschriften_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
			OR InStr(fsTableList,&quot;;ZwiSuGutschriften_&quot; &amp; iEinstellungsID_lokal &amp; &quot;;&quot;) = 0 _
		then
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Gutschriften1&quot;)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Gutschriften2&quot;)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemGutschriften&quot;)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuGutschriften&quot;)
		else
			SetDocUserProperty(&quot;oTabelle1_export&quot;, &quot;Gutschriften1_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oTabelle2_export&quot;, &quot;Gutschriften2_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oBemerkungen_export&quot;, &quot;ZwiBemGutschriften_&quot; &amp; iEinstellungsID_lokal)
			SetDocUserProperty(&quot;oZwischensummen_export&quot;, &quot;ZwiSuGutschriften_&quot; &amp; iEinstellungsID_lokal)
		end if
	End if

	if iClientID_export=0 then
		MsgBox(&quot;Sie haben noch kein Formular ausgewählt in welches die Datensätze exportiert werden sollen!&quot;,16,sTitle_lokal)
		Exit Sub
	End if

	sSQL2=&quot;INSERT INTO  &quot;&amp; sTabelle1_export &amp;_
		&quot;(ProjektID,Document_Name,KontaktID,Erstellungsdatum,gueltig_bis,Minutenverrechnungssatz,&quot;&amp;_
		&quot;Materialaufschlagsatz,Bemerkung,MwSt_Satz,Skonto_Satz,Skonto_Tage,Faellig_Tage)&quot;&amp;_
		&quot; SELECT t2.ProjektID,t1.Projekt_Name,t1.KontaktID,&quot;&amp;_
		&quot;date_add(now(),interval 0 day),date_add(now(),interval 0 day),&quot;&amp;_
		&quot;t1.Stundenverrechnungssatz/60,t1.Materialaufschlagsatz,&quot;&amp;_
		&quot;CONCAT(&apos;&quot;&amp; fBemerkung_export(iDocTypID_export) &amp;&quot;&apos;),&quot;&amp;_
		&quot;t3.MwSt_Satz,t3.Skonto_Satz,t3.Skonto_Tage,t3.Faellig_Tage&quot;&amp;_
		&quot; FROM &quot;&amp; sProjekte &amp;&quot; AS t1,Steuerung AS t2,&quot;&amp; sKunden &amp;&quot; AS t3&quot;&amp;_
		&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
		&quot; AND t1.ProjektID=t2.ProjektID&quot;&amp;_
		&quot; AND t3.KontaktID=t1.KontaktID&quot;

	SQL_execute(sSQL2)
	SQL_UPDATE_Tabelle1_export_DocumentID(1)
	SQL_UPDATE_Steuerung_export_DocumentID(0)
	SQL_UPDATE_Document1_Gesperrt_1(sTabelle1_export,lDocumentID_export(0))
	sDocumentID_export=CStr(lDocumentID_export(0))
	
	if oOptionLokation.State=1 then
		sGliederung1=&quot;Lokation&quot;
		sTextVorLokation=InputBox(&quot;Geben Sie bitte den Text ein, der vor dem Inhalt aus Spalte &quot;&amp;_
				chr(34) &amp;&quot;Lokation&quot;&amp; chr(34) &amp;&quot; stehen soll! Wenn Sie keinen Text benötigen, dann löschen Sie die Voreinstellung.&quot;_
				,sTitle_lokal,&quot;Leistungsort: &quot;)
		if oCheckBoxDatum.State=1 then
			sGliederung2=&quot;Erstellungsdatum&quot;
		End if
	elseif oOptionDatum.State=1 then
		sGliederung1=&quot;Erstellungsdatum&quot;
		if oCheckBoxLokation.State=1 then
			sGliederung2=&quot;Lokation&quot;
			sTextVorLokation=InputBox(&quot;Geben Sie bitte den Text ein, der vor dem Inhalt aus Spalte &quot;&amp;_
				chr(34) &amp;&quot;Lokation&quot;&amp; chr(34) &amp;&quot; stehen soll! Wenn Sie keinen Text benötigen, dann löschen Sie die Voreinstellung.&quot;_
				,sTitle_lokal,&quot;Leistungsort: &quot;)
		End if
	elseif oOptionZusammenfassung.State=1 then
		iCountLeistungen=1
		
		sSQL3_Count=&quot;SELECT COUNT(DISTINCT t1.LV_Pos,t1.LeistungsID,t1.Bestellnummer,t1.Leistungsbezeichnung,t1.Leistungsbeschreibung,&quot;&amp;_
			&quot;t1.Einkaufspreis,t1.Materialaufschlagsatz,t1.Bauzeit,t1.Minutenverrechnungssatz)&quot;

		sSQL3_Columns=&quot;SELECT DISTINCT t1.LV_Pos,t1.LeistungsID,t1.Bestellnummer,t1.Leistungsbezeichnung,t1.Leistungsbeschreibung,&quot;&amp;_
			&quot;t1.Einkaufspreis,t1.Materialaufschlagsatz,t1.Bauzeit,t1.Minutenverrechnungssatz&quot;

		sSQL3=&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
			&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
			&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
			&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
			&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
			&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
			&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
			&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
			&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
			&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
			&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
			&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
			&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
			&quot;  OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
			&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
			&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
			&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
			&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
			&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
			&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
			&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
			&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
			&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0)))&quot;

			oRecord1=oResult(sSQL3_Count &amp; sSQL3)
			While oRecord1.next()
				iAnzahlLeistungen=oRecord1.getInt(1)
			Wend
			
			sSQL3=sSQL3_Columns &amp; sSQL3 &amp;&quot; ORDER BY t1.LV_Pos ASC&quot;

		Do While iAnzahlLeistungen &gt;= iCountLeistungen
			oRecordLeistungen=oResult_Scroll(sSQL3)
			oRecordLeistungen.absolute(iCountLeistungen)
			sLV_Pos=oRecordLeistungen.getString(1)
			sLeistungsID=oRecordLeistungen.getString(2)
			sBestellnummer=oRecordLeistungen.getString(3)
			sLeistungsbezeichnung=oRecordLeistungen.getString(4)
			sLeistungsbeschreibung=oRecordLeistungen.getString(5)
			sEinkaufspreis=oRecordLeistungen.getString(6)
			sMaterialaufschlagsatz=oRecordLeistungen.getString(7)
			sBauzeit=oRecordLeistungen.getString(8)
			sMinutenverrechnungssatz=oRecordLeistungen.getString(9)
		
			sSQL4=&quot;SELECT SUM(t1.Menge)&quot;&amp;_
				&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
				&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
				&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
				&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
				&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
				&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
				&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
				&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
				&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
				&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
				&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
				&quot;  OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
				&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
				&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
				&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
				&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;&amp;_
				&quot; AND (t1.LeistungsID=&apos;&quot;&amp; sLeistungsID &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Leistungsbezeichnung=&apos;&quot;&amp; fsConvertApostroph(sLeistungsbezeichnung) &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Einkaufspreis=&apos;&quot;&amp; sEinkaufspreis &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Bauzeit=&apos;&quot;&amp; sBauzeit &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.LV_Pos=&apos;&quot;&amp; sLV_Pos &amp;&quot;&apos;&quot;
		
			if sBestellnummer = &quot;&quot; then
				sSQL4=sSQL4 &amp;&quot; AND (t1.Bestellnummer=&apos;&apos; OR t1.Bestellnummer IS NULL)&quot;
			else
				sSQL4=sSQL4 &amp;&quot; AND t1.Bestellnummer=&apos;&quot;&amp; sBestellnummer &amp;&quot;&apos;&quot;
			End if
			if sLeistungsbeschreibung = &quot;&quot; then
				sSQL4=sSQL4 &amp;&quot; AND (t1.Leistungsbeschreibung=&apos;&apos; OR t1.Leistungsbeschreibung IS NULL)&quot;
			else
				sSQL4=sSQL4 &amp;&quot; AND t1.Leistungsbeschreibung=&apos;&quot;&amp; fsConvertApostroph(sLeistungsbeschreibung) &amp;&quot;&apos;&quot;
			End if
			if sMaterialaufschlagsatz = &quot;&quot; then
				sSQL4=sSQL4 &amp;&quot; AND t1.Materialaufschlagsatz IS NULL&quot;
			else
				sSQL4=sSQL4 &amp;&quot; AND t1.Materialaufschlagsatz=&apos;&quot;&amp; sMaterialaufschlagsatz &amp;&quot;&apos;&quot;
			End if
			if sMinutenverrechnungssatz = &quot;&quot; then
				sSQL4=sSQL4 &amp;&quot; AND t1.Minutenverrechnungssatz IS NULL))&quot;
			else
				sSQL4=sSQL4 &amp;&quot; AND t1.Minutenverrechnungssatz=&apos;&quot;&amp; sMinutenverrechnungssatz &amp;&quot;&apos;))&quot;
			End if
		
			oRecord2=oResult(sSQL4)
			While oRecord2.next()
				sMenge=oRecord2.getString(1)
			Wend
			sSQL5=&quot;INSERT INTO  &quot;&amp; sArbeitstabelle_export &amp;_
				&quot; (DocumentID,LV_Pos,LeistungsID,Bestellnummer,Leistungsbezeichnung,Leistungsbeschreibung,&quot;&amp;_
				&quot;Einheit,Menge,Einkaufspreis,Bauzeit,Minutenverrechnungssatz,&quot;&amp;_
				&quot;Materialaufschlagsatz)&quot;&amp;_
				&quot; SELECT DISTINCT &apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,t1.LV_Pos,t1.LeistungsID,t1.Bestellnummer,&quot;&amp;_
				&quot;t1.Leistungsbezeichnung,t1.Leistungsbeschreibung,t1.Einheit,&apos;&quot;&amp; sMenge &amp;&quot;&apos;,t1.Einkaufspreis,&quot;&amp;_
				&quot;t1.Bauzeit,t1.Minutenverrechnungssatz,t1.Materialaufschlagsatz&quot;&amp;_
				&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
				&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
				&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
				&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
				&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
				&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
				&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
				&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
				&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
				&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
				&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
				&quot;  OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
				&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
				&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
				&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
				&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;&amp;_
				&quot; AND (t1.LeistungsID=&apos;&quot;&amp; sLeistungsID &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Leistungsbezeichnung=&apos;&quot;&amp; fsConvertApostroph(sLeistungsbezeichnung) &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Einkaufspreis=&apos;&quot;&amp; sEinkaufspreis &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.Bauzeit=&apos;&quot;&amp; sBauzeit &amp;&quot;&apos;&quot;&amp;_
				&quot; AND t1.LV_Pos=&apos;&quot;&amp; sLV_Pos &amp;&quot;&apos;&quot;
		
			if sBestellnummer = &quot;&quot; then
				sSQL5=sSQL5 &amp;&quot; AND (t1.Bestellnummer=&apos;&apos; OR t1.Bestellnummer IS NULL)&quot;
			else
				sSQL5=sSQL5 &amp;&quot; AND t1.Bestellnummer=&apos;&quot;&amp; sBestellnummer &amp;&quot;&apos;&quot;
			End if
			if sLeistungsbeschreibung = &quot;&quot; then
				sSQL5=sSQL5 &amp;&quot; AND (t1.Leistungsbeschreibung=&apos;&apos; OR t1.Leistungsbeschreibung IS NULL)&quot;
			else
				sSQL5=sSQL5 &amp;&quot; AND t1.Leistungsbeschreibung=&apos;&quot;&amp; fsConvertApostroph(sLeistungsbeschreibung) &amp;&quot;&apos;&quot;
			End if
			if sMaterialaufschlagsatz = &quot;&quot; then
				sSQL5=sSQL5 &amp;&quot; AND t1.Materialaufschlagsatz IS NULL&quot;
			else
				sSQL5=sSQL5 &amp;&quot; AND t1.Materialaufschlagsatz=&apos;&quot;&amp; sMaterialaufschlagsatz &amp;&quot;&apos;&quot;
			End if
			if sMinutenverrechnungssatz = &quot;&quot; then
				sSQL5=sSQL5 &amp;&quot; AND t1.Minutenverrechnungssatz IS NULL))&quot;
			else
				sSQL5=sSQL5 &amp;&quot; AND t1.Minutenverrechnungssatz=&apos;&quot;&amp; sMinutenverrechnungssatz &amp;&quot;&apos;))&quot;
			End if
		
			SQL_execute(sSQL5)
			iCountLeistungen=iCountLeistungen+1
		Loop
		
		SET_Option(iUserID_lokal,iClientID_export-iClientIDOffset(iUserID_lokal),1,1)
		SetUserID(iUserID_lokal)
		Projekt_oeffnen()
		exit Sub
	End if

&apos;#################################################################################################

	sSQL2_Count=&quot;SELECT COUNT(DISTINCT t1.&quot;&amp; sGliederung1 &amp;&quot;)&quot;

	sSQL2_Columns=&quot;SELECT DISTINCT t1.&quot;&amp; sGliederung1

	sSQL2=&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
		&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
		&quot; AND ((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
		&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
		&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
		&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
		&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
		&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
		&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
		&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
		&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
		&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
		&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
		&quot;  OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
		&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
		&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
		&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
		&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
		&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
		&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
		&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
		&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
		&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;

	oRecord1=oResult(sSQL2_Count &amp; sSQL2)
	iCountGliederung1=1
	iCountDatensaetze=0
	iAnzahlGliederung1=0
	iPosGliederung1=iMaxPos_export+1
	While oRecord1.next()
		iAnzahlGliederung1=oRecord1.getInt(1)
	Wend
	
	Do While iAnzahlGliederung1 &gt;= iCountGliederung1
	
		if iAnzahlGliederung1 &gt; 0 then
			sSQL3=sSQL2_Columns &amp; sSQL2
			if sGliederung1 = &quot;Erstellungsdatum&quot; then
				sSQL3=sSQL3 &amp;&quot; ORDER BY t1.Erstellungsdatum ASC&quot;
			elseif sGliederung1 = &quot;Lokation&quot; then
				sSQL3=sSQL3 &amp;&quot; ORDER BY t1.Lokation ASC&quot;
			End if
			oRecordGliederung1=oResult_Scroll(sSQL3)
			oRecordGliederung1.absolute(iCountGliederung1)
			sGliederungsText1 = oRecordGliederung1.getString(1)
			iCountGliederung1=iCountGliederung1+1
		
			if sGliederung1 = &quot;Erstellungsdatum&quot; then
				sBemerkung=&quot;Liefer- bzw. Leistungsdatum: &quot;&amp; fConvDatum(sGliederungsText1)
				sZwischensumme=sBemerkung
			elseif sGliederung1 = &quot;Lokation&quot; then
				sBemerkung= sTextVorLokation &amp; sGliederungsText1
				sZwischensumme=sBemerkung
			End if

			sSQL4=&quot;INSERT INTO  &quot;&amp; sBemerkungen_export &amp;_
				&quot; (DocumentID,Pos,Bemerkung)&quot;&amp;_
				&quot; VALUES (&apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,&apos;&quot;&amp; iPosGliederung1 &amp;&quot;&apos;,&apos;&quot;&amp; sBemerkung &amp;&quot;&apos;)&quot;
			SQL_execute(sSQL4)
		
		elseif iAnzahlGliederung1 = 0 then
			sGliederungsText1=&quot;%&quot;
		End if

&apos;###################################################################################################

		if sGliederung2 &lt;&gt; &quot;&quot; then

			sSQL7_Count=&quot;SELECT COUNT(DISTINCT t1.&quot;&amp; sGliederung2 &amp;&quot;)&quot;
			
			sSQL7_Columns=&quot;SELECT DISTINCT t1.&quot;&amp; sGliederung2
			
			sSQL7=&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
				&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
				&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
				&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
				&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
				&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
				&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
				&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
				&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
				&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
				&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
				&quot;  OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
				&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
				&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
				&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
				&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
				&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;&amp;_
				&quot; AND t1.&quot;&amp; sGliederung1 &amp;&quot; LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;)&quot;

	 		oRecord3=oResult(sSQL7_Count &amp; sSQL7)
			iCountGliederung2=1
			iAnzahlGliederung2=0

			While oRecord3.next()
				iAnzahlGliederung2=oRecord3.getInt(1)
			Wend
			
			Do While iAnzahlGliederung2 &gt;= iCountGliederung2
			
				if iAnzahlGliederung2 &gt; 0 then
					sSQL8=sSQL7_Columns &amp; sSQL7
					if sGliederung2 = &quot;Erstellungsdatum&quot; then
						sSQL8=sSQL8 &amp;&quot; ORDER BY t1.Erstellungsdatum ASC&quot;
					elseif sGliederung2 = &quot;Lokation&quot; then
						sSQL8=sSQL8 &amp;&quot; ORDER BY t1.Lokation ASC&quot;
					End if
					
					oRecordGliederung2=oResult_Scroll(sSQL8)
					oRecordGliederung2.absolute(iCountGliederung2)
					sGliederungsText2 = oRecordGliederung2.getString(1)
					iCountGliederung2=iCountGliederung2+1
				
					if sGliederung2 = &quot;Erstellungsdatum&quot; then
						sBemerkung=&quot;Liefer- bzw. Leistungsdatum: &quot;&amp; fConvDatum(sGliederungsText2)
					elseif sGliederung2 = &quot;Lokation&quot; then
						sBemerkung= sTextVorLokation &amp; sGliederungsText2
					End if

					sSQL9=&quot;INSERT INTO  &quot;&amp; sBemerkungen_export &amp;_
						&quot; (DocumentID,Pos,Bemerkung)&quot;&amp;_
						&quot; VALUES (&apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,&apos;&quot;&amp; iPosGliederung1 &amp;&quot;&apos;,&apos;&quot;&amp; sBemerkung &amp;&quot;&apos;)&quot;
					SQL_execute(sSQL9)
				
				elseif iAnzahlGliederung2 = 0 then
					sGliederungsText2=&quot;%&quot;
				End if

				sSQL5=&quot;SELECT COUNT(t1.Leistungsbezeichnung)&quot;&amp;_
					&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
					&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
					&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
					&quot; OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
					&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
					&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
					&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
					&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
					&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
					&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
					&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
					&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
					&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
					&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
					&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
					&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
					&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;
				if sGliederung1 = &quot;Erstellungsdatum&quot; then
					sSQL5=sSQL5 &amp;&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;&quot;&amp;_
						&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText2 &amp;&quot;&apos;)&quot;
				elseif sGliederung1 = &quot;Lokation&quot; then
					sSQL5=sSQL5 &amp;&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;&quot;&amp;_
						&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText2 &amp;&quot;&apos;)&quot;
				End if

				oRecord1=oResult(sSQL5)
				iAnzahlLeistungen = 0
				While oRecord1.next()
					iAnzahlLeistungen=oRecord1.getInt(1)
				Wend
				iCountDatensaetze=iCountDatensaetze+iAnzahlLeistungen
				iPosGliederung1=iPosGliederung1+iAnzahlLeistungen
			
				sSQL6=&quot;INSERT INTO  &quot;&amp; sArbeitstabelle_export &amp;_
					&quot; (DocumentID,LV_Pos,LeistungsID,Bestellnummer,Leistungsbezeichnung,Leistungsbeschreibung,&quot;&amp;_
					&quot;Einheit,Menge,Einkaufspreis,Bauzeit,Minutenverrechnungssatz,&quot;&amp;_
					&quot;Materialaufschlagsatz)&quot;&amp;_
					&quot; SELECT &apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,t1.LV_Pos,t1.LeistungsID,t1.Bestellnummer,&quot;&amp;_
					&quot;t1.Leistungsbezeichnung,t1.Leistungsbeschreibung,t1.Einheit,t1.Menge,t1.Einkaufspreis,&quot;&amp;_
					&quot;t1.Bauzeit,COALESCE(t1.Minutenverrechnungssatz,t2.Stundenverrechnungssatz/60*t2.Verrechnungs_Faktor),COALESCE(t1.Materialaufschlagsatz,t2.Materialaufschlagsatz)&quot;&amp;_
					&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
					&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
					&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
					&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
					&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
					&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
					&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
					&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
					&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
					&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
					&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
					&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
					&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
					&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
					&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
					&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
					&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;
				if sGliederung1 = &quot;Erstellungsdatum&quot; then
					sSQL6=sSQL6 &amp;&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;&quot;&amp;_
						&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText2 &amp;&quot;&apos;)&quot;
				elseif sGliederung1 = &quot;Lokation&quot; then
					sSQL6=sSQL6 &amp;&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;&quot;&amp;_
						&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText2 &amp;&quot;&apos;)&quot;
				End if
				SQL_execute(sSQL6)
			Loop
		else

&apos;###############################################################################################################

			sSQL5=&quot;SELECT COUNT(t1.Leistungsbezeichnung)&quot;&amp;_
				&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
				&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
				&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
				&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
				&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
				&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
				&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
				&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
				&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
				&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
				&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
				&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
				&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;
			if sGliederung1 = &quot;Erstellungsdatum&quot; then
				sSQL5=sSQL5 &amp;&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
					&quot; OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
					&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;)&quot;
			elseif sGliederung1 = &quot;Lokation&quot; then
				sSQL5=sSQL5 &amp;&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
					&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;)&quot;
			End if
			oRecord1=oResult(sSQL5)
			iAnzahlLeistungen = 0
			While oRecord1.next()
				iAnzahlLeistungen=oRecord1.getInt(1)
			Wend
			iCountDatensaetze=iCountDatensaetze+iAnzahlLeistungen
			iPosGliederung1=iPosGliederung1+iAnzahlLeistungen
		
			sSQL6=&quot;INSERT INTO  &quot;&amp; sArbeitstabelle_export &amp;_
				&quot; (DocumentID,LV_Pos,LeistungsID,Bestellnummer,Leistungsbezeichnung,Leistungsbeschreibung,&quot;&amp;_
				&quot;Einheit,Menge,Einkaufspreis,Bauzeit,Minutenverrechnungssatz,&quot;&amp;_
				&quot;Materialaufschlagsatz)&quot;&amp;_
				&quot; SELECT &apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,t1.LV_Pos,t1.LeistungsID,t1.Bestellnummer,&quot;&amp;_
				&quot;t1.Leistungsbezeichnung,t1.Leistungsbeschreibung,t1.Einheit,t1.Menge,t1.Einkaufspreis,&quot;&amp;_
				&quot;t1.Bauzeit,COALESCE(t1.Minutenverrechnungssatz,t2.Stundenverrechnungssatz/60*t2.Verrechnungs_Faktor),COALESCE(t1.Materialaufschlagsatz,t2.Materialaufschlagsatz)&quot;&amp;_
				&quot; FROM &quot;&amp; sControlling &amp;&quot; AS t1,Steuerung AS t2&quot;&amp;_
				&quot; WHERE t2.ClientID=&quot;&amp; iClientID &amp;_
				&quot; AND (((year(t1.Erstellungsdatum)=t2.Jahr AND t2.Jahr IS NOT NULL)&quot;&amp;_
				&quot;  OR (year(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Jahr IS NULL))&quot;&amp;_
				&quot; AND ((month(t1.Erstellungsdatum)=t2.Monat AND t2.Monat IS NOT NULL)&quot;&amp;_
				&quot;  OR (month(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Monat IS NULL))&quot;&amp;_
				&quot; AND ((week(t1.Erstellungsdatum)=t2.Woche AND t2.Woche IS NOT NULL)&quot;&amp;_
				&quot;  OR (week(t1.Erstellungsdatum) LIKE &apos;%&apos; AND t2.Woche IS NULL))&quot;&amp;_
				&quot; AND ((t1.PersonalID=t2.PersonalID AND t2.PersonalID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.PersonalID LIKE &apos;%&apos; AND t2.PersonalID IS NULL))&quot;&amp;_
				&quot; AND ((t1.ProjektID=t2.ProjektID AND t2.ProjektID IS NOT NULL)&quot;&amp;_
				&quot;  OR (t1.ProjektID LIKE &apos;%&apos; AND t2.ProjektID IS NULL))&quot;&amp;_
				&quot; AND ((t1.LeistungsTyp=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=0)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp!=t2.LeistungsTyp AND t2.LeistungsTyp!=0 AND t2.Option_4=1)&quot;&amp;_
				&quot;  OR (t1.LeistungsTyp LIKE &apos;%&apos; AND t2.LeistungsTyp=0))&quot;&amp;_
				&quot; AND ((t1.Abgerechnet=t2.Status AND t2.Status!=0)&quot;&amp;_
				&quot;  OR (t1.Abgerechnet LIKE &apos;%&apos; AND t2.Status=0))&quot;
			if sGliederung1 = &quot;Erstellungsdatum&quot; then
				sSQL6=sSQL6 &amp;&quot; AND ((t1.Lokation=t2.Lokation AND t2.Lokation is not NULL)&quot;&amp;_
					&quot; OR (t1.Lokation LIKE &apos;%&apos; AND t2.Lokation is NULL))&quot;&amp;_
					&quot; AND t1.Erstellungsdatum LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;)&quot;
			elseif sGliederung1 = &quot;Lokation&quot; then
				sSQL6=sSQL6 &amp;&quot; AND ((t1.Erstellungsdatum=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=0)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum&lt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=1)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum&gt;=t2.Datum AND LENGTH(t2.Datum)&gt;0 AND t2.Option_5=2)&quot;&amp;_
					&quot;  OR (t1.Erstellungsdatum LIKE &apos;%&apos; AND (LENGTH(t2.Datum) is NULL OR LENGTH(t2.Datum)=0)))&quot;&amp;_
					&quot; AND t1.Lokation LIKE &apos;&quot;&amp; sGliederungsText1 &amp;&quot;&apos;)&quot;
			End if
			SQL_execute(sSQL6)
		end if
		sSQL9=&quot;INSERT INTO  &quot;&amp; sZwischensummen_export &amp;&quot;(DocumentID,Pos,ZwiSuName)&quot;&amp;_
			&quot; VALUES (&apos;&quot;&amp; sDocumentID_export &amp;&quot;&apos;,&apos;&quot;&amp;_
			fAnzahlDatensaetze(sArbeitstabelle_export,sDocumentID_export) &amp;&quot;&apos;,&apos;&quot;&amp; sZwischensumme &amp;&quot;&apos;)&quot;
		SQL_execute(sSQL9)
	Loop

	SET_Option(iUserID_lokal,iClientID_export-iClientIDOffset(iUserID_lokal),1,1)
	SetUserID(iUserID_lokal)
	Projekt_oeffnen()

	vStatus=MsgBox(&quot;Möchten Sie bei der aktuelle Auswahl der Datensätze den Status &quot;&amp; Chr(34) &amp;&quot;abgerechnet&quot;&amp; Chr(34) &amp;&quot; setzen?&quot;,36,sTitle_lokal)
	if vStatus=6 then
		Status_setzen_abgerechnet()
	End if
End Sub
</script:module>